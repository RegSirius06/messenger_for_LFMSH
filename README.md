# Мессенджер для ЛФМШ

При создании я вдохновлялся и использовал как образец данный репозиторий: https://github.com/RegSirius06/lisbank

## Общие комментарии

Фактически, данный сайт можно назвать копией мессенджера из репозитория выше. Тем не менее, есть некоторые отличия в реализации. Самые заметные изменения - у чатов появились свои иконки, появились объявления - новый тип сообщений.

## Комментарий по поводу эксплуатации проекта

Я рекомендую вам использовать именно данную конфигурацию сайта, с данной базой данных. В ней только один пользователь, он же и супер-юзер.

`Логин: admin`

`Пароль: admin`

Сменить пароль можно на admin-панели (её адрес, например, localhost:8000/admin/) в разделе "Пользователи".
Нельзя менять логин этого пользователя, группы, в которых он состоит, фамилию, имя, отчество, пользователя, отряд в аккаунте, связанном с этим пользователем.

Тем не менее, вы можете создать свою базу данных с нуля. В таком случае:


1. Создайте суперпользователя с логином admin.

2. Запустите сайт

3. Войдите в админ-панель сайта

4. Добавьте аккаунт (в разделе "Accounts") с привязкой к созданному пользователю, с обязательным заполнением именно таким образом следующих панелей:

    - `Пользователь: admin`

    - `Фамилия: Admin`

    - `Отряд: 0`


Остальные поля заполняйте на ваше усмотрение.

Используйте отряд номер 0 как отряд для педсостава.

После успешной регистрации пользователя можно перейти непосредственно в мессенджер (по адресу, например, "localhost:8000").

## Установка и запуск

Нужно установить Python 3.11 и младше, если вы этого не сделали.
`python.org`

### Способ 1 (рекомендуется)
1. Запустите терминал, перейти в папку проекта.
2. Зайдите в виртуальную среду (`venv`):
```bash
source venv/bin/activate # Linux
venv\bin\Activate.ps1 # Windows
```
Должна появиться надпись (venv) в начале

3. Запустить файл `manage.py` командой
```bash
python3 manage.py runserver 0.0.0.0:8000 --insecure # Linux
python .\manage.py runserver 0.0.0.0:8000 --insecure # Windows
```
Сайт доступен в локальной сети под адресом сервера на порте 8000.
Например, если адрес вашего ПК в локальной сети `192.168.50.40`, это будет адрес `192.168.50.40:8000`.

### Способ 2
1. Установите необходимые пакеты с помощью pip:
```bash
pip install -r requirements.txt 
```
2. Запустить файл `manage.py` командой
```bash
python3 manage.py runserver 0.0.0.0:8000 --insecure # Linux
python .\manage.py runserver 0.0.0.0:8000 --insecure # Windows
```
## Регистрация пользователей

Пользователей можно зарегистрировать в разделе "Работа с пользователями". После регистрации его логин и пароль будут записаны в в файл "All_users.txt". Обратите внимание, что при удалении пользователя запись о нём в файле остаётся.

При сбросе всех паролей будут обновлены пароли у всех пользователей, логин которых не содержит текста "admin". После сброса паролей обновлённый список будет находиться в файле "All_users.txt".

## Темы отображения сообщений

### Регистрация встроенных тем

Если вы используете базу данных, предложенную в данном проекте, то все встроенные темы уже зарегистрированы.

Если вы сгенерировали новую базу данных, то вам необходимо их зарегистрировать вручную. Это можно сделать только через admin-панель. Вы должны зайти в admin-панель, её адрес `192.168.50.40:8000/admin/`, если адрес вашего ПК `192.168.50.40`. В разделе LFMSH выбираем пункт Themes. В правом верхнем углу нажимаем кнопку `Добавить THEME`. В открывшемся окне заполняем поля следующим образом:

1. \
`Название темы: Повышенная контрастность`
\
`Тип темы: Компьютерный`
\
`Постфикс: contr`

Не забываем сохранить новую тему.

По аналогии добавляем следующие темы:

2. \
`Название темы: Чёрно-белый`
\
`Тип темы: Компьютерный`
\
`Постфикс: blackandwhit`

3. \
`Название темы: Аналог встроенной темы`
\
`Тип темы: Телефонный`
\
`Постфикс: base`

4. \
`Название темы: Повышенная контрастность (смартфон)`
\
`Тип темы: Телефонный`
\
`Постфикс: recommended`

После добаввления данных тем в admin-панель их можно будет менять на соответствующей странице.

### Добавление своей темы

Если вы хотите добавить свою тему, то вам нужно сделать следующие два шага:

__1. Добавить разметку темы в css.__

Сначала вы должны определиться, какой тип темы у вас будет: `компьютерный` или `телефонный`.

После этого можно писать тему в css. Файл находися в папке `lfmsh/static/css/styles.css`; только из этого файла считываются темы.

Шаблон css для темы типа `компьютерный`:

```css
/* Стиль таблицы */
.table_xxx{
    font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
    border-collapse: collapse;
    color: #686461;
}
/* Стиль заголовка таблицы (не используется) */
.caption_xxx{
    padding: 10px;
    color: white;
    background: #8FD4C1;
    font-size: 18px;
    text-align: left;
    font-weight: bold;
}
/* Стиль первой строки таблицы */
.th_xxx{
    border-bottom: 3px solid #B9B29F;
    padding: 10px;
    text-align: left;
}
/* Стиль ячейки таблицы */
.td_xxx{
    padding: 10px;
}
/* Стиль строки таблицы */
.tr_xxx:nth-child(odd){
    background: white;
}
.tr_xxx:nth-child(even){
    background: #E8E6D1;
}
```
_В качестве примера взята встроенная тема._


Шаблон css для темы типа `телефонный`:

```css
/* Стиль заголовка с отображением отправителя */
.h3_xxx{
    background: #f0f0f0;
    font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
    color: #686461;
}
/* Стиль делителя элементов сообщения */
.hr_middle_xxx{
    width: 100%;
    text-align: left;
    margin-left: 0;
    border-width: 0;
    color: #c0c0c0;
    background-color: #c0c0c0;
    height: 2px;
}
/* Стиль остального текста */
.txt_xxx{
    background: #f7f7f7;
    font-family: "Lucida Sans Unicode", "Lucida Grande", Sans-Serif;
    color: #686461;
}
/* Стиль делителя сообщений */
.hr_end_xxx{
    width: 100%;
    text-align: left;
    margin-left: 0;
    border-width: 0;
    color: black;
    background-color: black;
    height: 3px;
}
```
_В качестве примера взята тема "повышенная контрастность для смартфона"._


В обоих шаблонах в названиях вместо `xxx` пишите текст, характеризующий вашу тему. Он не должен превышать 15 символов в длину. Убедитесь, что таких же заголовков нет в файле. Текст пишите латиницей, можно использовать символ `_`.

__2. Зарегистрировать тему в базе данных.__

После добавления разметки новой темы в css вам необходимо зарегистрировать эту тему. Это можно сделать только через admin-панель. Вы должны зайти в admin-панель, её адрес `192.168.50.40:8000/admin/`, если адрес вашего ПК `192.168.50.40`. В разделе LFMSH выбираем пункт Themes. В правом верхнем углу нажимаем кнопку `Добавить THEME`. В открывшемся окне заполняем следующие поля новой темы.

1. `Название темы: [название темы]`
\
Вместо [название темы] пишем название, которое наиболее точно характеризует новую тему. Не стоит давать слишком длинное название.

2. `Тип темы: [Компьютерный/Телефонный]`
\
Выбираем тот тип темы, под который делали новую тему, иначе будет некорректное отображение темы.

3. `Постфикс: [xxx]`
\
В качестве примера указан постфикс `xxx`, т.к. в примерах все названия заканчивались на `xxx`. Вы должны вписать то окончание, которое вы приписали ко всем названиям вместо `xxx`. Это очень важно для отображения темы.

Не забываем сохранить новую тему.

После сохранения темы она будет доступна в качестве темы на выбор на странице с изменением темы.

### Изменение встроенных тем

#### ___Изменять тему "Встроенная" категорически запрещается! На ней держится весь сайт!___

Изменение остальных тем не рекомендуется, однако не влечёт никаких последствий, кроме изменения дизайна сообщений при выборе данной темы.

__Вы должны чётко понимать, к чему приведёт изменение той или иной темы! Это касается не только встроенных тем.__

## P.S. Хочу поблагодарить пользователя [Alexander](https://github.com/idutvuk) за создание `venv` для моего проекта.

## Хорошего пользования!